<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="Content-Style-Type" content="text/css" />
        <meta name="generator" content="pandoc" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
                    <title></title>
        <style type="text/css">code{white-space: pre;}</style>
                          <link rel="stylesheet" href="./themes/cyverse/templates/main.css" type="text/css" />
                    <link rel="icon" href="themes/cyverse/media/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="themes/cyverse/media/css/normalize.min.css">
        <link rel="stylesheet" href="themes/cyverse/media/css/main.css">
        <script src="themes/cyverse/media/js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
          </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

                <div class="header-container">
            <header class="wrapper clearfix">
                <div class="logo"><img src="themes/cyverse/media/cyverse_logo.png" alt="Staff Guide"></div>
                <h1 class="title"></h1>
            </header>
        </div>
        
        <div class="main-container">
            <div class="main wrapper clearfix">
              <!-- TABLE OF CONTENTS -->
                                  <aside>
                      <h3> TABLE OF CONTENTS </h3>
                      <ul>
                      <li><a href="#implementing-web-desktop-novnc-proxy">Implementing Web Desktop (NoVNC Proxy)</a><ul>
                      <li><a href="#overview-how-it-works">Overview / How It Works</a><ul>
                      <li><a href="#server-components">Server Components</a><ul>
                      <li><a href="#nginx-novnc-authenticationproxy"><a href="https://github.com/cyverse/nginx_novnc_auth">Nginx NoVNC authentication/proxy</a></a></li>
                      <li><a href="#vnc-server-and-novnc-server-on-instance">VNC Server and NoVNC Server on instance</a></li>
                      <li><a href="#atmosphere-ansible">atmosphere-ansible</a></li>
                      </ul></li>
                      <li><a href="#workflows">Workflows</a><ul>
                      <li><a href="#at-instance-deploy-time">At Instance Deploy Time</a></li>
                      <li><a href="#at-connection-time">At Connection Time</a></li>
                      </ul></li>
                      </ul></li>
                      <li><a href="#implementation-guide">Implementation Guide</a></li>
                      <li><a href="#questions">Questions</a></li>
                      </ul></li>
                      </ul>
                  </aside>
                              <!-- MAIN CONTENT -->
              <article>
              <h1 id="implementing-web-desktop-novnc-proxy">Implementing Web Desktop (NoVNC Proxy)</h1>
              <h2 id="overview-how-it-works">Overview / How It Works</h2>
              <p><a href="https://kanaka.github.io/noVNC/">NoVNC</a> (<a href="https://github.com/novnc/noVNC/blob/master/README.md">readme</a>) is an HTML5 VNC client. It is used with Atmosphere to provide a seamless experience for users who wish to interact with their instance with a GUI rather than a shell.</p>
              <h3 id="server-components">Server Components</h3>
              <h4 id="nginx-novnc-authenticationproxy"><a href="https://github.com/cyverse/nginx_novnc_auth">Nginx NoVNC authentication/proxy</a></h4>
              <p>This code contains a Flask application that authenticates users, and an Nginx configuration to proxy websockets.</p>
              <p>It can be installed on the same server that runs GateOne.</p>
              <h4 id="vnc-server-and-novnc-server-on-instance">VNC Server and NoVNC Server on instance</h4>
              <p>The instance runs the commercial VNC Server (which must be licensed).</p>
              <h4 id="atmosphere-ansible">atmosphere-ansible</h4>
              <p>atmosphere-ansible configures VNC Server and NoVNC websocket server on new instances via <a href="https://github.com/cyverse/atmosphere-ansible/blob/master/ansible/playbooks/instance_deploy/40_novnc_install.yml">40_novnc_install.yml</a> and the <a href="https://github.com/cyverse/atmosphere-ansible/tree/master/ansible/roles/atmo-novnc">atmo-novnc</a> role.</p>
              <h3 id="workflows">Workflows</h3>
              <h4 id="at-instance-deploy-time">At Instance Deploy Time</h4>
              <p>atmosphere-ansible roughly does this:</p>
              <ul>
              <li>Checks for existence of an X window server on the instance</li>
              <li>Installs NoVNC websocket server bits (Julian, can you clarify?)</li>
              <li>Is a VNC server installed by atmosphere-ansible or is it expected to already be available on the instances?</li>
              <li>Starts and configures VNC Server, sets license</li>
              <li>Sets the “Web desktop” value in Atmosphere database (how?)</li>
              </ul>
              <p>Then, the Web Desktop button will appear when the instance page is loaded.</p>
              <h4 id="at-connection-time">At Connection Time</h4>
              <ul>
              <li>User browses to page for an active instance, clicks “Web Desktop” button</li>
              <li>NoVNC client code loads in browser, client establishes a web socket to the instance via NoVNC proxy</li>
              <li>How does auth work?</li>
              <li>What else?</li>
              <li>VNC session launches</li>
              </ul>
              <h2 id="implementation-guide">Implementation Guide</h2>
              <p>Choose a server to run the Nginx NoVNC Auth services</p>
              <p>…</p>
              <h2 id="questions">Questions</h2>
              <ul>
              <li>What exactly does the NoVNC server component on instances do?</li>
              <li>Regarding terminology, does the “NoVNC Proxy” run on the Atmosphere instance or on the Nginx server?</li>
              <li>How does Atmosphere come to know that an instance has web desktop enabled?</li>
              <li>Why do we have a NoVNC proxy? For auth?</li>
              <li>How is auth handled for the websocket, i.e. how does the instance authenticate users? Shared secret between instance and NoVNC proxy, and NoVNC proxy somehow confirms that requests came from Atmosphere?</li>
              </ul>
              </article>
            </div> <!-- #main -->
        </div> <!-- #main-container -->

                <div class="footer-container">
            <footer class="wrapper">
                    <footer class="footer"> <!-- Needs to be a `include-after` -->
          		<div class="container">
          		  <div class="region region-footer">
          		    <section id="block-block-25" class="block block-block clearfix">
          		      <p><img alt="Cyverse" src="./media/cyverse_icon_transp2.png" style="width: 25px; height: 24px;">&nbsp;<a href="http://www.cyverse.org/">CyVerse</a> | <a href="http://www.cyverse.org/open-source">Open Source</a> | <img alt="NSF" src="./media/nsf1.gif" style="width: 25px; height: 25px;">&nbsp;</p>
          		    </section>
          		  </div>
          		</div>
        	    </footer>
            </footer>
        </div>
        <!-- Included at the end of body -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="themes/cyverse/media/js/vendor/jquery-1.11.2.min.js"><\/script>')</script>
        
        <script src="themes/cyverse/media/js/main.js"></script>
            </body>
</html>
